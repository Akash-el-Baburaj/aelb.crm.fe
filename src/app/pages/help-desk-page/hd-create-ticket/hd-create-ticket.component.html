<!-- Breadcrumb -->
<div class="breadcrumb-card mb-25 d-md-flex align-items-center justify-content-between">
    <h5 class="mb-0">
        {{ isEdit ? 'Edit Task' : 'Create Task' }}
    </h5>
    <ol class="breadcrumb list-unstyled mt-0 mb-0 pl-0">
        <li class="breadcrumb-item position-relative">
            <a routerLink="/" class="d-inline-block position-relative">
                <i class="ri-home-8-line"></i>
                Dashboard
            </a>
        </li>
        <li class="breadcrumb-item position-relative">
            Task
        </li>
        <li class="breadcrumb-item position-relative">
            {{ isEdit ? 'Edit Task' : 'Create Task' }}
        </li>
    </ol>
</div>

<mat-card class="daxa-card create-project-card mb-25 border-radius bg-white border-none d-block" [class.rtl-enabled]="themeService.isRTLEnabled()">
    <mat-card-header>
        <mat-card-title>
            <h5 class="mb-0">
                {{ isEdit ? 'Edit Task' : 'Create New Task' }}
            </h5>
        </mat-card-title>
    </mat-card-header>
    <mat-card-content>
        <form [formGroup]="taskForm" (ngSubmit)="onSubmit()">
            <div class="row">
                <div class="col-lg-8">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Task Title <span class="text-danger">*</span></label>
                                <mat-form-field appearance="outline" class="w-100">
                                    <mat-label>Enter task title</mat-label>
                                    <input matInput formControlName="taskTitle" required>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Team or Individual <span class="text-danger">*</span></label>
                                <mat-form-field appearance="outline" class="w-100">
                                    <mat-label>Select</mat-label>
                                    <mat-select formControlName="teamOrIndividual" required>
                                        <mat-option *ngFor="let opt of teamOrIndividualOptions" [value]="opt.value">{{opt.label}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Status <span class="text-danger">*</span></label>
                                <mat-form-field appearance="outline" class="w-100">
                                    <mat-label>Select status</mat-label>
                                    <mat-select formControlName="status" required>
                                        <mat-option *ngFor="let s of statusOptions" [value]="s.value">{{s.label}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Assigned User <span class="text-danger">*</span></label>
                                <mat-form-field appearance="outline" class="w-100">
                                    <mat-label>Select user</mat-label>
                                    <mat-select formControlName="userId" required>
                                        <mat-option *ngFor="let user of users" [value]="user.id">{{user.name || user.email}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Team</label>
                                <mat-form-field appearance="outline" class="w-100">
                                    <mat-label>Select team</mat-label>
                                    <mat-select formControlName="teamId">
                                        <mat-option *ngFor="let team of teams" [value]="team.id">{{team.name}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Contact</label>
                                <mat-form-field appearance="outline" class="w-100">
                                    <mat-label>Select contact</mat-label>
                                    <mat-select formControlName="contactId">
                                        <mat-option *ngFor="let contact of contacts" [value]="contact.id">{{contact.name || contact.email}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Lead</label>
                                <mat-form-field appearance="outline" class="w-100">
                                    <mat-label>Select lead</mat-label>
                                    <mat-select formControlName="leadId">
                                        <mat-option *ngFor="let lead of leads" [value]="lead.id">{{lead.name}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Customer</label>
                                <mat-form-field appearance="outline" class="w-100">
                                    <mat-label>Select customer</mat-label>
                                    <mat-select formControlName="customerId">
                                        <mat-option *ngFor="let customer of customers" [value]="customer.id">{{customer.name}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-sm-12">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Report</label>
                                <mat-form-field appearance="outline" class="w-100">
                                    <mat-label>Enter report</mat-label>
                                    <textarea matInput formControlName="report" rows="3"></textarea>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-sm-12">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Details</label>
                                <mat-form-field appearance="outline" class="w-100">
                                    <mat-label>Enter details</mat-label>
                                    <textarea matInput formControlName="details" rows="3"></textarea>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-sm-12">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Task Image</label>
                                <input type="file" (change)="onFileChange($event)" accept="image/*">
                                <div *ngIf="imageBase64" class="mt-2">
                                    <img [src]="imageBase64" alt="Task Image" style="max-width: 120px; max-height: 120px; border-radius: 8px;">
                    </div>
                </div>
                    </div>
                    </div>
                </div>
            </div>

            <!-- File Upload -->
            <div class="mb-25">
              <label class="main-label d-block lh-1 text-black">Attach Files</label>
              <input type="file" (change)="onFilesSelected($event)" multiple>
              <button mat-raised-button color="primary" (click)="uploadTaskFiles()" [disabled]="!selectedFiles?.length || uploading">
                {{ uploading ? 'Uploading...' : 'Upload Files' }}
              </button>
            </div>

            <!-- File List -->
            <div *ngIf="taskFiles?.length">
              <h6>Task Files</h6>
              <ul>
                <li *ngFor="let file of taskFiles">
                  <a [href]="file.filepath" target="_blank">{{ file.filename }}</a>
                  <span *ngIf="file.User"> â€” {{ file.User.name }} ({{ file.User.email }})</span>
                </li>
              </ul>
            </div>

            <div class="btn-box">
                <button mat-raised-button color="primary" type="submit" [disabled]="loading || taskForm.invalid">
                    {{ loading ? (isEdit ? 'Updating...' : 'Saving...') : (isEdit ? 'Update Task' : 'Create Task') }}
                </button>
            </div>
        </form>
    </mat-card-content>
</mat-card>