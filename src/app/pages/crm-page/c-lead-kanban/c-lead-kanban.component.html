<!-- Kanban Board -->
<div
    class="row bg-gray p-3"
    cdkDropListGroup
    [class.component-dark-theme]="themeService.isDark()"
    [class.rtl-enabled]="themeService.isRTLEnabled()"
>
    <div class="col-sm-6 col-lg-4 col-xxxl-3">
        <mat-card class="daxa-card kanban-board-card mb-25 border-radius bg-gradient border-none d-block">
            <mat-card-header>
                <mat-card-title>
                    <h5 class="mt-0 text-white">
                        Open Lead ({{open.length}})
                    </h5>
                    <span class="d-block text-white">
                        This month add {{open.length}} new projects
                    </span>
                </mat-card-title>
                <mat-card-subtitle>
                    <button type="button" mat-button class="card-header-menu-btn p-0" [matMenuTriggerFor]="cardHeaderMenu">
                        <i class="material-symbols-outlined">
                            more_horiz
                        </i>
                    </button>
                    <mat-menu #cardHeaderMenu="matMenu" class="card-header-menu" xPosition="before">
                        <button mat-menu-item>
                            Select All
                        </button>
                        <button mat-menu-item>
                            Edit All
                        </button>
                        <button mat-menu-item>
                            Delete All
                        </button>
                    </mat-menu>
                </mat-card-subtitle>
            </mat-card-header>
        </mat-card>
        <div
            cdkDropList
            [cdkDropListData]="open"
            [id]="getDropListId('open')"
            [cdkDropListConnectedTo]="[getDropListId('in progress'), getDropListId('won'), getDropListId('lost')]"
            (cdkDropListDropped)="drop($event)"
        >
            @for (item of open; track item) {
                <mat-card class="daxa-card kanban-board-card mb-25 border-radius bg-white border d-block" cdkDrag>
                    <mat-card-content>
                        <div class="row">
                            <div class="col-2">
                                <div class="icon position-relative text-center rounded-circle">
                                    <img [src]="item.image" alt="client-image" onerror="this.src='images/users/user12.jpg';">
                                </div>
                            </div>
                            <div class="col-10">
                                <div class="head d-flex align-items-center justify-content-between">
                                    <span class="d-block fw-medium" style="cursor: pointer;" routerLink="/crm-page/profile">
                                        {{item.name}}
                                    </span>
                                    <span class="d-block text-daxa">
                                        {{item.company}}
                                    </span>
                                </div>
                                <div class="d-flex">
                                    <span class="date text-body d-block position-relative" >
                                        <i class="material-symbols-outlined" style="font-size: small !important;">
                                            email
                                        </i>
                                        {{item.email}}
                                    </span>&nbsp;&nbsp;|&nbsp;&nbsp;
                                    <span class="date text-body d-block position-relative">
                                        <i class="material-symbols-outlined" style="font-size: small !important;">
                                            phone
                                        </i>
                                        {{item.phone}}
                                    </span>

                                </div>
                            </div>
                        </div>
                        <span class="daxa-badge text-success d-inline-block">
                            {{item.leadSource}}
                        </span>
                        <div class="footer d-flex align-items-center justify-content-between">
                            <span class="date text-body d-block position-relative">
                                <i class="material-symbols-outlined">
                                    schedule
                                </i>
                                {{item.lastContacted}}
                            </span>
                            <div class="users-list">
                                <img [src]="item.img1" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-1" *ngIf="item.img1">
                                <img [src]="item.img2" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-2" *ngIf="item.img2">
                                <img [src]="item.img3" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-3" *ngIf="item.img3">
                                <img [src]="item.img4" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-4" *ngIf="item.img4">
                                <img [src]="item.img5" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-5" *ngIf="item.img5">
                            </div>
                        </div>
                    </mat-card-content>
                </mat-card>
            }
        </div>
        <div class="mb-25">
            <button
                mat-button
                class="add-another-task-btn"
                (click)="toggleClass()"
            >
                + Add Another Lead
            </button>
        </div>
    </div>
    <div class="col-sm-6 col-lg-4 col-xxxl-3">
        <mat-card class="daxa-card kanban-board-card mb-25 border-radius bg-gradient border-none d-block">
            <mat-card-header>
                <mat-card-title>
                    <h5 class="mt-0 text-white">
                        In Progress ({{inProgress.length}})
                    </h5>
                    <span class="d-block text-white">
                        This month progress {{inProgress.length}} new projects
                    </span>
                </mat-card-title>
                <mat-card-subtitle>
                    <button type="button" mat-button class="card-header-menu-btn p-0" [matMenuTriggerFor]="cardHeaderMenu">
                        <i class="material-symbols-outlined">
                            more_horiz
                        </i>
                    </button>
                    <mat-menu #cardHeaderMenu="matMenu" class="card-header-menu" xPosition="before">
                        <button mat-menu-item>
                            Select All
                        </button>
                        <button mat-menu-item>
                            Edit All
                        </button>
                        <button mat-menu-item>
                            Delete All
                        </button>
                    </mat-menu>
                </mat-card-subtitle>
            </mat-card-header>
        </mat-card>
        <div
            cdkDropList
            [cdkDropListData]="inProgress"
            [id]="getDropListId('in progress')"
            [cdkDropListConnectedTo]="[getDropListId('open'), getDropListId('won'), getDropListId('lost')]"
            (cdkDropListDropped)="drop($event)"
        >
            @for (item of inProgress; track item) {
                <mat-card class="daxa-card kanban-board-card mb-25 border-radius bg-white border d-block" cdkDrag>
                    <mat-card-content>
                        <div class="row">
                            <div class="col-2">
                                <div class="icon position-relative text-center rounded-circle">
                                    <img [src]="item.image" alt="client-image">
                                </div>
                            </div>
                            <div class="col-10">
                                <div class="head d-flex align-items-center justify-content-between">
                                    <span class="d-block fw-medium" style="cursor: pointer;" routerLink="/crm-page/profile">
                                        {{item.name}}
                                    </span>
                                    <span class="d-block text-daxa">
                                        {{item.company}}
                                    </span>
                                </div>
                                <div class="d-flex">
                                    <span class="date text-body d-block position-relative" >
                                        <i class="material-symbols-outlined" style="font-size: small !important;">
                                            email
                                        </i>
                                        {{item.email}}
                                    </span>&nbsp;&nbsp;|&nbsp;&nbsp;
                                    <span class="date text-body d-block position-relative">
                                        <i class="material-symbols-outlined" style="font-size: small !important;">
                                            phone
                                        </i>
                                        {{item.phone}}
                                    </span>

                                </div>
                            </div>
                        </div>
                        <span class="daxa-badge text-success d-inline-block">
                            {{item.leadSource}}
                        </span>
                        <div class="footer d-flex align-items-center justify-content-between">
                            <span class="date text-body d-block position-relative">
                                <i class="material-symbols-outlined">
                                    schedule
                                </i>
                                {{item.createDate}}
                            </span>
                            <div class="users-list">
                                <img [src]="item.img1" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-1" *ngIf="item.img1">
                                <img [src]="item.img2" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-2" *ngIf="item.img2">
                                <img [src]="item.img3" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-3" *ngIf="item.img3">
                                <img [src]="item.img4" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-4" *ngIf="item.img4">
                                <img [src]="item.img5" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-5" *ngIf="item.img5">
                            </div>
                        </div>
                    </mat-card-content>
                </mat-card>
            }
        </div>
        <div class="mb-25">
            <button
                mat-button
                class="add-another-task-btn"
                (click)="toggleClass()"
            >
                + Add Another Lead
            </button>
        </div>
    </div>
    <div class="col-sm-6 col-lg-4 col-xxxl-3">
        <mat-card class="daxa-card kanban-board-card mb-25 border-radius bg-gradient border-none d-block">
            <mat-card-header>
                <mat-card-title>
                    <h5 class="mt-0 text-white">
                        Closed Won ({{won.length}})
                    </h5>
                    <span class="d-block text-white">
                        This month review {{won.length}} projects
                    </span>
                </mat-card-title>
                <mat-card-subtitle>
                    <button type="button" mat-button class="card-header-menu-btn p-0" [matMenuTriggerFor]="cardHeaderMenu">
                        <i class="material-symbols-outlined">
                            more_horiz
                        </i>
                    </button>
                    <mat-menu #cardHeaderMenu="matMenu" class="card-header-menu" xPosition="before">
                        <button mat-menu-item>
                            Select All
                        </button>
                        <button mat-menu-item>
                            Edit All
                        </button>
                        <button mat-menu-item>
                            Delete All
                        </button>
                    </mat-menu>
                </mat-card-subtitle>
            </mat-card-header>
        </mat-card>
        <div
            cdkDropList
            [cdkDropListData]="won"
            [id]="getDropListId('won')"
            [cdkDropListConnectedTo]="[getDropListId('open'), getDropListId('in progress'), getDropListId('lost')]"
            (cdkDropListDropped)="drop($event)"
        >
            @for (item of won; track item) {
                <mat-card class="daxa-card kanban-board-card mb-25 border-radius bg-white border d-block" cdkDrag>
                    <mat-card-content>
                        <div class="row">
                            <div class="col-2">
                                <div class="icon position-relative text-center rounded-circle">
                                    <img [src]="item.image" alt="client-image">
                                </div>
                            </div>
                            <div class="col-10">
                                <div class="head d-flex align-items-center justify-content-between">
                                    <span class="d-block fw-medium" style="cursor: pointer;" routerLink="/crm-page/profile">
                                        {{item.name}}
                                    </span>
                                    <span class="d-block text-daxa">
                                        {{item.company}}
                                    </span>
                                </div>
                                <div class="d-flex">
                                    <span class="date text-body d-block position-relative" >
                                        <i class="material-symbols-outlined" style="font-size: small !important;">
                                            email
                                        </i>
                                        {{item.email}}
                                    </span>&nbsp;&nbsp;|&nbsp;&nbsp;
                                    <span class="date text-body d-block position-relative">
                                        <i class="material-symbols-outlined" style="font-size: small !important;">
                                            phone
                                        </i>
                                        {{item.phone}}
                                    </span>

                                </div>
                            </div>
                        </div>
                        <span class="daxa-badge text-success d-inline-block">
                            {{item.leadSource}}
                        </span>
                        <div class="footer d-flex align-items-center justify-content-between">
                            <span class="date text-body d-block position-relative">
                                <i class="material-symbols-outlined">
                                    schedule
                                </i>
                                {{item.createDate}}
                            </span>
                            <div class="users-list">
                                <img [src]="item.img1" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-1" *ngIf="item.img1">
                                <img [src]="item.img2" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-2" *ngIf="item.img2">
                                <img [src]="item.img3" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-3" *ngIf="item.img3">
                                <img [src]="item.img4" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-4" *ngIf="item.img4">
                                <img [src]="item.img5" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-5" *ngIf="item.img5">
                            </div>
                        </div>
                    </mat-card-content>
                </mat-card>
            }
        </div>
        <div class="mb-25">
            <button
                mat-button
                class="add-another-task-btn"
                (click)="toggleClass()"
            >
                + Add Another Lead
            </button>
        </div>
    </div>
    <div class="col-sm-6 col-lg-4 col-xxxl-3">
        <mat-card class="daxa-card kanban-board-card mb-25 border-radius bg-gradient border  border-white  d-block">
            <mat-card-header>
                <mat-card-title>
                    <h5 class="mt-0 text-white">
                        Closed Lost ({{lost.length}})
                    </h5>
                    <span class="d-block text-white">
                        This month completed {{lost.length}} projects
                    </span>
                </mat-card-title>
                <mat-card-subtitle>
                    <button type="button" mat-button class="card-header-menu-btn p-0" [matMenuTriggerFor]="cardHeaderMenu">
                        <i class="material-symbols-outlined">
                            more_horiz
                        </i>
                    </button>
                    <mat-menu #cardHeaderMenu="matMenu" class="card-header-menu" xPosition="before">
                        <button mat-menu-item>
                            Select All
                        </button>
                        <button mat-menu-item>
                            Edit All
                        </button>
                        <button mat-menu-item>
                            Delete All
                        </button>
                    </mat-menu>
                </mat-card-subtitle>
            </mat-card-header>
        </mat-card>
        <div
            cdkDropList
            [cdkDropListData]="lost"
            [id]="getDropListId('lost')"
            [cdkDropListConnectedTo]="[getDropListId('open'), getDropListId('in progress'), getDropListId('won')]"
            (cdkDropListDropped)="drop($event)"
        >
            @for (item of lost; track item) {
                <mat-card class="daxa-card kanban-board-card mb-25 border-radius bg-white border-none d-block" cdkDrag>
                    <mat-card-content>
                        <div class="row">
                            <div class="col-2">
                                <div class="icon position-relative text-center rounded-circle">
                                    <img [src]="item.image" alt="client-image">
                                </div>
                            </div>
                            <div class="col-10">
                                <div class="head d-flex align-items-center justify-content-between">
                                    <span class="d-block fw-medium" style="cursor: pointer;" routerLink="/crm-page/profile">
                                        {{item.name}}
                                    </span>
                                    <span class="d-block text-daxa">
                                        {{item.company}}
                                    </span>
                                </div>
                                <div class="d-flex">
                                    <span class="date text-body d-block position-relative" >
                                        <i class="material-symbols-outlined" style="font-size: small !important;">
                                            email
                                        </i>
                                        {{item.email}}
                                    </span>&nbsp;&nbsp;|&nbsp;&nbsp;
                                    <span class="date text-body d-block position-relative">
                                        <i class="material-symbols-outlined" style="font-size: small !important;">
                                            phone
                                        </i>
                                        {{item.phone}}
                                    </span>

                                </div>
                            </div>
                        </div>
                        <span class="daxa-badge text-success d-inline-block">
                            {{item.leadSource}}
                        </span>
                        <div class="footer d-flex align-items-center justify-content-between">
                            <span class="date text-body d-block position-relative">
                                <i class="material-symbols-outlined">
                                    schedule
                                </i>
                                {{item.lastContacted}}
                            </span>
                            <div class="users-list">
                                <img [src]="item.img1" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-1" *ngIf="item.img1">
                                <img [src]="item.img2" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-2" *ngIf="item.img2">
                                <img [src]="item.img3" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-3" *ngIf="item.img3">
                                <img [src]="item.img4" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-4" *ngIf="item.img4">
                                <img [src]="item.img5" alt="user-image" onerror="this.src='images/users/user12.jpg';" matTooltip="user-5" *ngIf="item.img5">
                            </div>
                        </div>
                    </mat-card-content>
                </mat-card>
            }
        </div>
        <div class="mb-25">
            <button
                mat-button
                class="add-another-task-btn"
                (click)="toggleClass()"
            >
                + Add Another Lead
            </button>
        </div>
    </div>
</div>

<!-- Popup -->
<div
    class="add-another-task-popup"
    [class.active]="classApplied"
    [class.rtl-enabled]="themeService.isRTLEnabled()"
>
    <div class="popup-dialog">
        <mat-card class="daxa-card mb-25 border-radius bg-white border-none d-block">
            <mat-card-header>
                <mat-card-title>
                    <h5 class="mb-0">
                        Add Lead
                    </h5>
                </mat-card-title>
                <mat-card-subtitle>
                    <button
                        mat-button
                        (click)="toggleClass()"
                    >
                        <i class="ri-close-fill"></i>
                    </button>
                </mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
                <form [formGroup]="leadForm" (ngSubmit)="onSubmit()">
                    <div class="row">
                        <div class="col-md-4 col-sm-6">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Customer Name</label>
                                <mat-form-field>
                                    <mat-label>Enter customer name</mat-label>
                                    <input matInput formControlName="name" placeholder="E.g. Marcia Baker">
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Email Address</label>
                                <mat-form-field>
                                    <mat-label>Enter email address</mat-label>
                                    <input matInput formControlName="email" placeholder="E.g. marcia@example.com">
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Phone Number</label>
                                <mat-form-field>
                                    <mat-label>Enter phone number</mat-label>
                                    <input matInput formControlName="phone" placeholder="E.g. +1 555-123-4567">
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Company</label>
                                <mat-form-field>
                                    <mat-label>Enter company</mat-label>
                                    <input matInput formControlName="company" placeholder="E.g. Acme Inc.">
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Products/Services</label>
                                <mat-form-field>
                                    <mat-label>Select products/services</mat-label>
                                    <mat-select formControlName="productOrServiceIds" multiple>
                                        <mat-option *ngFor="let prod of products" [value]="prod.id">{{ prod.name }}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Lead Source</label>
                                <mat-form-field>
                                    <mat-label>Select lead source</mat-label>
                                    <mat-select formControlName="leadSource">
                                        <mat-option value="Website">Website</mat-option>
                                        <mat-option value="Referral">Referral</mat-option>
                                        <mat-option value="Cold Call">Cold Call</mat-option>
                                        <mat-option value="Email Campaign">Email Campaign</mat-option>
                                        <mat-option value="Online Store">Online Store</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6">
                            <div class="mb-25">
                                <label class="main-label d-block lh-1 text-black">Customer Image</label>
                                <input type="file" (change)="onFileSelected($event)" accept="image/*">
                                <img *ngIf="base64Image" [src]="base64Image" style="width:48px;height:48px;object-fit:cover;margin-top:10px;">
                            </div>
                        </div>
                    </div>
                    <div class="btn-box">
                        <button mat-button type="submit">Create Lead</button>
                        <button mat-button type="button" (click)="router.navigate(['/crm-page/leads'])">Cancel</button>
                    </div>
                </form>
            </mat-card-content>
        </mat-card>
    </div>
</div>